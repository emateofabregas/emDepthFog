add_layer {P P.x P.y P.z P.red P.green P.blue P.alpha P.X P.Y P.Z P.z}
Group {
 name emDepthFog1
 inputs 2
 knobChanged "import nuke\n\nn = nuke.thisNode()\nk = nuke.thisKnob()\n\n### INPUT CREATION\n## UTILS Input\ncheckutils = nuke.toNode('InputUTILS')\n\nif n.knob('input_utils').value() ==False:\n    if checkutils:\n        nuke.delete(checkutils)  # Delete 'Inpututils' if it exists     \nelse:\n    if not checkutils: \n        matteInput = nuke.createNode('Input', \"name InputUTILS\", inpanel=False) # Create Input node \n        enableutils = nuke.toNode('Switch3')\n        \n        if matteInput:\n            enableutils.setInput(1, matteInput)\n                                    \n            # Adjust 'Inpututils' position relative to 'enable_utils'\n            matteInput.setYpos(enableutils.ypos() - 50)  # Adjusting Y-position, not X-position\n            matteInput.setXpos(enableutils.xpos())       # Aligning X-position\n\n###KNOB CHANGED\n#Enable Labels\nif k.name() == 'enable_glow':\n    if n.knob('enable_glow').getValue() == 0:\n        n.knob('enable_glow_text').setLabel('<font color=\"\">Enable</font>')\n        n.knobs()\['sample'].setVisible(False)\n        n.knobs()\['intensity'].setVisible(False)\n        n.knobs()\['value'].setVisible(False)\n        n.knobs()\['size'].setVisible(False)\n    else:\n        n.knob('enable_glow_text').setLabel('<font color=\"green\">Enable</font>')\n        n.knobs()\['sample'].setVisible(True)\n        n.knobs()\['intensity'].setVisible(True)\n        n.knobs()\['value'].setVisible(True)\n        n.knobs()\['size'].setVisible(True)\n        \nif k.name() == 'enableSkyRamp':\n    if n.knob('enableSkyRamp').getValue() == 0:\n        n.knob('enableSkyRamp_text').setLabel('<font color=\"\">Enable</font>')\n        n.knob('end_color_q').setVisible(False)\n        n.knob('start').setVisible(False)\n        n.knob('start_ramp').setVisible(False)\n        n.knob('end').setVisible(False)\n        n.knob('end_ramp').setVisible(False)\n        n.knob('opacity_1').setVisible(False)\n        n.knob('hardness_ramp').setVisible(False)\n        n.knob('color_start').setVisible(False)\n        n.knob('color_end').setVisible(False)\n        n.knob('generate_id_skyRamp').setVisible(False)\n        n.knob('falloff_ramp_color').setVisible(False)\n    else:\n        n.knob('enableSkyRamp_text').setLabel('<font color=\"green\">Enable</font>')\n        n.knob('end_color_q').setVisible(True)\n        n.knob('start').setVisible(True)\n        n.knob('start_ramp').setVisible(True)\n        n.knob('end').setVisible(True)\n        n.knob('end_ramp').setVisible(True)\n        n.knob('opacity_1').setVisible(True)\n        n.knob('hardness_ramp').setVisible(True)\n        n.knob('color_start').setVisible(True)\n        n.knob('color_end').setVisible(True)\n        n.knob('generate_id_skyRamp').setVisible(True)\n        n.knob('falloff_ramp_color').setVisible(True)\n\n##mode\nif n\['mode'].value() == 'P_World':\n    n\['z_near'].setVisible(False)\n    n\['z_far'].setVisible(False)\n    n\['near_3d'].setVisible(True)\n    n\['far_3d'].setVisible(True)\n    n\['mirror_p'].setVisible(True)\n    n\['invert_p'].setVisible(True)\nelse:\n    n\['z_near'].setVisible(True)\n    n\['z_far'].setVisible(True)\n    n\['near_3d'].setVisible(False)\n    n\['far_3d'].setVisible(False)\n    n\['mirror_p'].setVisible(False)\n    n\['invert_p'].setVisible(True)\n\n### PICKER\n##Depth\nzdepth = nuke.toNode(f\"Shuffle1\")\n# Near Values\nif k.name() == 'near':\n    posFar = n\['near'].value()  # The position picked\n    \n    # Check if proxy mode is active\n    if n\['mode'].value() == 'ZDepth':             \n        # Sample RGB values from the node\n        r = zdepth.sample('red',  posFar\[0], posFar\[1],)\n                \n        # Set the z_near knob with the sampled values\n        n\['z_near'].setValue(\[r])\n            \n# Far Values\nif k.name() == 'far':\n    posFar = n\['far'].value()  # The position picked\n    \n    if n\['mode'].value() == 'ZDepth':             \n        # Sample RGB values from the node\n        r = zdepth.sample('red',  posFar\[0], posFar\[1],)\n            \n        # Set the z_far knob with the sampled values\n        n\['z_far'].setValue(\[r])\n\n\n##P_World\npworld = nuke.toNode(f\"Shuffle2\")\n# Near Values\nif k.name() == 'near':\n    posFar = n\['near'].value()  # The position picked\n    animated = nuke.thisKnob().isAnimated()\n    \n    # Check if proxy mode is active\n    if nuke.root().knob('proxy').value():\n        nuke.message('You have to disable proxy mode to use this feature.')\n    else:\n        # Handle 'P_World' mode\n        if n\['mode'].value() == 'P_World':             \n            # Sample RGB values from the node\n            r = pworld.sample('red',  posFar\[0], posFar\[1],)\n            g = pworld.sample('green', posFar\[0], posFar\[1])\n            b = pworld.sample('blue',  posFar\[0], posFar\[1])\n            \n            n = nuke.thisNode()\n            if animated:\n                if not n.knob('near_3d').isAnimated():\n                    n.knob('near_3d').setAnimated()\n            else:\n                n.knob('near_3d').clearAnimated()\n                \n            # Set the near_3d knob with the sampled values\n            n\['near_3d'].setValue(\[r, g, b])\n            \n# Far Values\nif k.name() == 'far':\n    pworld = nuke.toNode(f\"Shuffle2\")\n    posFar = n\['far'].value()  # The position picked\n    animated = nuke.thisKnob().isAnimated()\n    \n    # Check if proxy mode is active\n    if nuke.root().knob('proxy').value():\n        nuke.message('You have to disable proxy mode to use this feature.')\n    else:\n        # Handle 'Static' mode\n        if n\['mode'].value() == 'P_World':             \n            # Sample RGB values from the node\n            r = pworld.sample('red',  posFar\[0], posFar\[1],)\n            g = pworld.sample('green', posFar\[0], posFar\[1])\n            b = pworld.sample('blue',  posFar\[0], posFar\[1])\n            \n            if animated:\n                if not n.knob('far_3d').isAnimated():\n                    n.knob('far_3d').setAnimated()\n            else:\n                n.knob('far_3d').clearAnimated()\n                \n            # Set the far_3d knob with the sampled values\n            n\['far_3d'].setValue(\[r, g, b])\n            \n            \n##Sky Map\npworld = nuke.toNode(f\"Shuffle2\")\n# Start Values\nif k.name() == 'start':\n    posStart = n\['start'].value()  # The position picked\n    animated = nuke.thisKnob().isAnimated()\n    \n    # Check if proxy mode is active\n    if nuke.root().knob('proxy').value():\n        nuke.message('You have to disable proxy mode to use this feature.')\n    else:\n        # Handle 'P_World' mode\n        if n\['start']:             \n            # Sample RGB values from the node\n            r = pworld.sample('red',  posStart\[0], posStart\[1],)\n            g = pworld.sample('green', posStart\[0], posStart\[1])\n            b = pworld.sample('blue',  posStart\[0], posStart\[1])\n            \n            n = nuke.thisNode()\n            if animated:\n                if not n.knob('start_3d').isAnimated():\n                    n.knob('start_3d').setAnimated()\n            else:\n                n.knob('start_3d').clearAnimated()\n                \n            # Set the near_3d knob with the sampled values\n            n\['start_ramp'].setValue(\[g])\n            \n# Far Values\nif k.name() == 'end':\n    pworld = nuke.toNode(f\"Shuffle2\")\n    posEnd = n\['end'].value()  # The position picked\n    animated = nuke.thisKnob().isAnimated()\n    \n    # Check if proxy mode is active\n    if nuke.root().knob('proxy').value():\n        nuke.message('You have to disable proxy mode to use this feature.')\n    else:\n        # Handle 'Static' mode\n        if n\['end']:             \n            # Sample RGB values from the node\n            r = pworld.sample('red',  posEnd\[0], posEnd\[1],)\n            g = pworld.sample('green', posEnd\[0], posEnd\[1])\n            b = pworld.sample('blue',  posEnd\[0], posEnd\[1])\n            \n            if animated:\n                if not n.knob('end_3d').isAnimated():\n                    n.knob('end_3d').setAnimated()\n            else:\n                n.knob('end_3d').clearAnimated()\n                \n            # Set the far_3d knob with the sampled values\n            n\['end_ramp'].setValue(\[g])"
 tile_color 0x5289c4ff
 label "\[value mode]"
 addUserKnob {20 User l emDepthFog t "Make a fake Fog using P_World or ZDepth AOVs."}
 addUserKnob {4 preview l "view mode" t "Different previews are designed to check the Final Image, the fog, and the fog with color and glow stuff." M {"Final Image" Fog "Fog with Color" Sky "Sky with Color" Glow "" "" "" "" "" ""}}
 addUserKnob {26 ""}
 addUserKnob {6 input_utils l "Input UTILS" t "Creates an input UTILS if you have the Data AOV in a different brunch." +STARTLINE}
 addUserKnob {6 unpremultiply l "Unpremultiply UTILS" t "Unpremultiply the UTILS/Data AOVS." -STARTLINE}
 unpremultiply true
 addUserKnob {41 in l P_World t "Set up P AOV here. " T Shuffle2.in}
 addUserKnob {41 in_1 l ZDepth t "Set up ZDepth AOV here. Ideally, set up your depth AOV filtered." T Shuffle1.in}
 addUserKnob {6 generate_id_fogFX l "Generate ID Fog FX" t "Creates an additional AOV/layer with the fog FX only. " +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {26 text_fog l "@b;Depth Fog" T " "}
 addUserKnob {4 mode l "" t "Fog Mode. P_World works with P (position) AOV and ZDepth with depth.Z AOV. P_World mode keeps the fog at the same position and ZDepth follows the camera movement. " -STARTLINE M {P_World ZDepth "" "" "" ""}}
 addUserKnob {6 near_color_q l "Enable Near Color" t "Adds an additional color in your depth fog close to the near values. " -STARTLINE}
 near_color_q true
 addUserKnob {12 near l "near pick" t "Picker of near point."}
 near {1030 780}
 addUserKnob {13 near_3d l "" t "Adjust the near position in 3D" -STARTLINE}
 near_3d {-6605.059082 1363.104248 -7421.023438}
 addUserKnob {7 z_near l " " -STARTLINE +HIDDEN R 0 1000}
 addUserKnob {12 far l "far pick" t "Picker of far point."}
 far {413 770}
 addUserKnob {13 far_3d l "" t "Adjust the far position in 3D" -STARTLINE}
 far_3d {-6605.059082 1363.104248 9993.944336}
 addUserKnob {7 z_far l " " -STARTLINE +HIDDEN R 0 1000}
 z_far 612837.4375
 addUserKnob {6 mirror_p l Mirror t "Mirrors P mask." +STARTLINE}
 addUserKnob {6 invert_p l Invert t "Inverts the P Mask." -STARTLINE}
 addUserKnob {7 opacity t "Adjust the opacity of the depth fog here. "}
 opacity 0.2
 addUserKnob {6 color_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 color_panelDropped true
 addUserKnob {6 color_rgb_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 color_rgb_panelDropped true
 addUserKnob {7 hardness t "It makes the ramp sharper. 0 = smooth, 1= sharp"}
 addUserKnob {18 color_near l "color near" t "Pick the near color here. "}
 color_near {0.9838265777 1.087949157 1.996488333}
 addUserKnob {6 color_near_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 color_rgb_2_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 color_rgb_2_panelDropped true
 addUserKnob {18 color_far l "color far" t "Pick the far color here. "}
 color_far {0.496378 0.496378 0.496378}
 addUserKnob {6 color_far_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {7 gamma l "falloff colors" t "You can play with this knob to blend the colors more. It's similar of the hardness knob, but it's playing with a different algorithm (the gamma one)" R 0 4}
 gamma 1
 addUserKnob {6 generate_id_depthFog l "Generate ID Depth Fog" t "Creates an additional AOV/layer with the Depth Fog only." +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {26 ramp_text l "@b;Sky Ramp" T " "}
 addUserKnob {6 enableSkyRamp l "" t "Checking this box enables the Sky Ramp effect. If you don't use it, please uncheck this box. " -STARTLINE}
 addUserKnob {26 enableSkyRamp_text l "<font color=\"\">Enable</font>" -STARTLINE T " "}
 addUserKnob {6 end_color_q l "Enable End Color" t "Adds an additional color in your ramp close to the end values. " -STARTLINE +HIDDEN}
 end_color_q true
 addUserKnob {12 start l "start pick" t "Pick the start ramp color here. " +HIDDEN}
 start {1156 1108}
 addUserKnob {7 start_ramp l "" t "Start ramp values. It updates automatically using the pickers, but you can adjust it by hand as well." -STARTLINE +HIDDEN R 0 10000}
 start_ramp 2049.758545
 addUserKnob {12 end l "end pick" t "Pick the end ramp color here. " +HIDDEN}
 end {1066 814}
 addUserKnob {7 end_ramp l "" t "End ramp values. It updates automatically using the pickers, but you can adjust it by hand as well." -STARTLINE +HIDDEN R 0 10000}
 end_ramp 1434.600342
 addUserKnob {13 start_3d +INVISIBLE}
 start_3d {39413.46875 39413.46875 39413.46875}
 addUserKnob {13 end_3d l "end 3d" +INVISIBLE}
 end_3d {9388.392578 9388.392578 9388.392578}
 addUserKnob {7 opacity_1 l opacity t "Adjust the opacity of the sky ramp. " +HIDDEN}
 opacity_1 0.15
 addUserKnob {7 hardness_ramp l hardness t "It makes the ramp sharper. 0 = smooth, 1= sharp" +HIDDEN}
 addUserKnob {18 color_start l "color start" t "Pick the start color here. " +HIDDEN}
 color_start {1 0.828971 0.472866}
 addUserKnob {6 color_start_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {18 color_end l "color end" t "Pick the end color here. " +HIDDEN}
 color_end {1 0.701111 0.303259}
 addUserKnob {6 color_end_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
 addUserKnob {6 color_rgb_1_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
 color_rgb_1_panelDropped true
 addUserKnob {7 falloff_ramp_color l "falloff color" t "You can play with this knob to blend the colors more. It's similar of the hardness knob, but it's playing with a different algorithm (the gamma one)" +HIDDEN R 0 4}
 falloff_ramp_color 1
 addUserKnob {6 generate_id_skyRamp l "Generate ID Sky Ramp" t "Creates an additional AOV/layer with the Sky Ramp only. " +HIDDEN +STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {26 text_glow l "@b;Glow" T " "}
 addUserKnob {6 enable_glow l "" t "Enables the Glow Effect. This Glow follows the Mask of the Fog and Sky Ramp as well." -STARTLINE}
 addUserKnob {26 enable_glow_text l "<font color=\"\">Enable</font>" -STARTLINE T " "}
 addUserKnob {41 sample +HIDDEN T emGlow1.sample}
 addUserKnob {41 intensity +HIDDEN T emGlow1.intensity}
 addUserKnob {41 value l tint t "Tint your glow effect here." +HIDDEN T emGlow1.value}
 addUserKnob {41 size t "Adjust the size of the glow here." +HIDDEN T emGlow1.size}
 addUserKnob {26 ""}
 addUserKnob {7 overscan R 0 100}
 overscan 100
 addUserKnob {6 crop -STARTLINE}
 addUserKnob {26 ""}
 addUserKnob {26 _1 l mask T ""}
 addUserKnob {41 maskChannelMask l "" -STARTLINE T Merge1.maskChannelMask}
 addUserKnob {41 inject -STARTLINE T Merge1.inject}
 addUserKnob {41 invert_mask l invert -STARTLINE T Merge1.invert_mask}
 addUserKnob {41 fringe -STARTLINE T Merge1.fringe}
 addUserKnob {41 mix T Merge1.mix}
 addUserKnob {26 ""}
 addUserKnob {26 autor l "" +STARTLINE T "<font color=\"grey\">emDepthFog v1.2 | emateofabregas.com | 2024-2025 </font>"}
}
 Input {
  inputs 0
  name InputImg
  label 0
  xpos 0
  ypos -134
 }
set Nb0544480 [stack 0]
 Dot {
  name Dot10
  xpos 34
  ypos 448
 }
set N88364000 [stack 0]
push $Nb0544480
 Switch {
  which 1
  name Switch3
  label UTILS
  xpos -210
  ypos -134
  disable {{"!\[exists input1]"}}
 }
 AddChannels {
  channels alpha
  color 1
  format_size true
  name AddChannels1
  xpos -210
  ypos -63
 }
 Shuffle {
  in P
  in2 rgba
  alpha alpha2
  name Shuffle2
  label Input_PWorld
  xpos -210
  ypos -3
 }
set N8835d400 [stack 0]
 Remove {
  operation keep
  channels rgba
  name Remove1
  xpos -210
  ypos 44
 }
 Unpremult {
  name Unpremult1
  xpos -210
  ypos 104
  disable {{!parent.unpremultiply}}
 }
set N8835de00 [stack 0]
 Shuffle2 {
  fromInput1 {
   {0}
   B
  }
  fromInput2 {
   {0}
   B
  }
  mappings "4 rgba.green 0 1 rgba.green 0 1 rgba.green 0 1 rgba.alpha 0 3 rgba.green 0 1 rgba.red 0 0 rgba.green 0 1 rgba.blue 0 2"
  name Shuffle4
  label "g to alpha"
  xpos -652
  ypos 98
 }
 Grade {
  channels rgba
  blackpoint {{parent.end_ramp}}
  whitepoint {{parent.start_ramp}}
  white_clamp true
  name Grade3
  label "sky values"
  xpos -652
  ypos 184
 }
 Expression {
  expr3 "smoothstep(0,1-hardness_ramp, a)"
  name Expression5
  label Hardness
  xpos -652
  ypos 233
  addUserKnob {20 User}
  addUserKnob {7 hardness_ramp l hardness}
  hardness_ramp {{parent.hardness_ramp}}
 }
 Expression {
  channel3 rgba
  expr3 "pow(a, 1/falloff)"
  name Expression6
  label Falloff
  xpos -652
  ypos 279
  addUserKnob {20 User}
  addUserKnob {7 falloff R 0 4}
  falloff {{parent.falloff_ramp_color}}
 }
set N8838f900 [stack 0]
 Dot {
  name Dot7
  xpos -503
  ypos 288
 }
 Merge2 {
  inputs 2
  operation mask
  bbox B
  name Merge5
  xpos -537
  ypos 445
 }
 Dot {
  name Dot6
  xpos -503
  ypos 529
 }
set N88364800 [stack 0]
push $N8838f900
 Constant {
  inputs 0
  channels rgb
  color {{parent.color_start} {parent.color_start} {parent.color_start} {parent.color_start}}
  name Constant4
  label "color start"
  xpos -1189
  ypos 343
 }
 Constant {
  inputs 0
  channels rgb
  color {{parent.color_start} {parent.color_start} {parent.color_start} {parent.color_start}}
  name Constant5
  label "color end"
  xpos -1194
  ypos 443
  disable {{!parent.end_color_q}}
 }
 Merge2 {
  inputs 2+1
  operation plus
  Achannels rgb
  name Merge6
  xpos -652
  ypos 381
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy2
  xpos -652
  ypos 520
 }
 Grade {
  channels rgba
  white {{parent.opacity_1}}
  name Grade5
  label Opacity
  xpos -652
  ypos 679
 }
 Premult {
  name Premult1
  xpos -652
  ypos 787
 }
set N883d0d00 [stack 0]
push $N8835d400
 Shuffle {
  in depth
  in2 rgba
  alpha red
  name Shuffle1
  label Input_ZDepth
  xpos -1053
  ypos -3
 }
 Remove {
  operation keep
  channels rgba
  name Remove3
  xpos -1053
  ypos 44
 }
 Unpremult {
  name Unpremult2
  xpos -1053
  ypos 68
  disable {{!parent.unpremultiply}}
 }
 Grade {
  channels rgba
  blackpoint {{parent.z_near}}
  whitepoint {{parent.z_far}}
  white 0.5
  multiply {{parent.opacity}}
  gamma {{parent.gamma}}
  white_clamp true
  name Grade1
  label "Depth Range"
  xpos -1053
  ypos 145
 }
 Expression {
  channel3 rgba
  expr3 1-a
  name Expression8
  label Invert
  xpos -1053
  ypos 190
  disable {{!parent.invert_p}}
 }
 Expression {
  expr3 "smoothstep(0,1-hardness_depth, a)"
  name Expression7
  label Hardness
  xpos -1053
  ypos 236
  addUserKnob {20 User}
  addUserKnob {7 hardness_depth l hardness}
  hardness_depth {{parent.hardness}}
 }
set N883f9200 [stack 0]
 Dot {
  name Dot9
  xpos -901
  ypos 245
 }
 Dot {
  name Dot8
  xpos -901
  ypos 501
 }
push $N883f9200
 Constant {
  inputs 0
  channels rgb
  color {{parent.color_near} {parent.color_near} {parent.color_near} 1}
  name Constant2
  label "color near"
  xpos -1187
  ypos 148
  disable {{!parent.near_color_q}}
 }
set N883f9700 [stack 0]
 Constant {
  inputs 0
  channels rgb
  color {{parent.color_far} {parent.color_far} {parent.color_far} 1}
  name Constant1
  label "color far"
  xpos -1187
  ypos 240
 }
set N88ae4500 [stack 0]
 Merge2 {
  inputs 2+1
  operation plus
  Achannels rgb
  name Merge3
  xpos -1053
  ypos 353
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy3
  xpos -1053
  ypos 492
 }
 Dot {
  name Dot4
  xpos -1019
  ypos 620
 }
push $N8835de00
 Expression {
  temp_name0 dot
  temp_expr0 "(far_x - near_x)*(r - near_x) + (far_y - near_y)*(g - near_y) + (far_z - near_z)*(b - near_z)"
  temp_name1 len2
  temp_expr1 "(far_x - near_x)*(far_x - near_x) + (far_y - near_y)*(far_y - near_y) + (far_z - near_z)*(far_z - near_z) + 1e-8"
  temp_name2 clamp
  temp_expr2 "clamp(dot/len2, 0, 1)"
  temp_name3 mask
  temp_expr3 "smoothstep(0,1-hardness, clamp)"
  channel3 rgba
  expr3 mask
  name Expression1
  label "3D ramp"
  xpos -210
  ypos 140
  addUserKnob {20 User}
  addUserKnob {7 near_x}
  near_x {{parent.near_3d.x}}
  addUserKnob {7 near_y}
  near_y {{parent.near_3d.y}}
  addUserKnob {7 near_z}
  near_z {{parent.near_3d.z}}
  addUserKnob {7 far_x}
  far_x {{parent.far_3d.x}}
  addUserKnob {7 far_y}
  far_y {{parent.far_3d.y}}
  addUserKnob {7 far_z}
  far_z {{parent.far_3d.z}}
  addUserKnob {7 hardness}
  hardness {{parent.hardness}}
 }
 Expression {
  expr3 "a * (1.0 - a) * 4.0"
  name Expression2
  label Mirror
  xpos -210
  ypos 186
  disable {{!parent.mirror_p}}
 }
 Expression {
  channel3 rgba
  expr3 1-a
  name Expression3
  label Invert
  xpos -210
  ypos 243
  disable {{!parent.invert_p}}
 }
 Expression {
  channel3 rgba
  expr3 "pow(a, 1/falloff)"
  name Expression4
  label Falloff
  xpos -210
  ypos 317
  addUserKnob {20 User}
  addUserKnob {7 falloff R 0 4}
  falloff {{parent.gamma}}
 }
set N88ae6800 [stack 0]
 Dot {
  name Dot5
  xpos -56
  ypos 326
 }
 Dot {
  name Dot3
  xpos -56
  ypos 539
 }
push $N88ae6800
push $N88ae4500
push $N883f9700
 Merge2 {
  inputs 2+1
  operation plus
  output {rgba.red rgba.green rgba.blue -rgba.alpha}
  name Merge9
  xpos -210
  ypos 380
 }
 Copy {
  inputs 2
  from0 rgba.alpha
  to0 rgba.alpha
  name Copy1
  xpos -203
  ypos 530
 }
 Switch {
  inputs 2
  which {{parent.mode}}
  name Switch2
  label mode
  xpos -203
  ypos 611
 }
 Grade {
  channels rgba
  white {{parent.opacity}}
  name Grade2
  label Opacity
  xpos -203
  ypos 687
 }
 Premult {
  name Premult6
  xpos -203
  ypos 759
 }
set N88b4e800 [stack 0]
 Merge2 {
  inputs 2
  operation plus
  name Merge4
  xpos -203
  ypos 800
  disable {{!parent.enableSkyRamp}}
 }
 Dot {
  name Dot2
  xpos -169
  ypos 855
 }
set N88b64000 [stack 0]
push $N883d0d00
push $N88b4e800
push $N88b64000
 Constant {
  inputs 0
  color 1
  name Constant3
  xpos 148
  ypos 724
 }
 Input {
  inputs 0
  name InputMask
  label 2
  xpos 268
  ypos 846
  number 1
 }
 Switch {
  inputs 2
  which 1
  name Switch
  label "Input Mask"
  xpos 148
  ypos 846
  disable {{"\[exists parent.input1]"}}
 }
push $N88b64000
push $N88364000
 Dot {
  name Dot1
  xpos 34
  ypos 713
 }
 Merge2 {
  inputs 2+1
  operation plus
  bbox B
  Achannels rgb
  name Merge1
  xpos 0
  ypos 852
 }
 Group {
  inputs 2
  name emGlow1
  tile_color 0xf2873aff
  label "\[value in]"
  xpos 0
  ypos 911
  disable {{!parent.enable_glow}}
  addUserKnob {20 User l emGlow t "Exponential Glow effect. "}
  addUserKnob {6 glow_only l "Glow Only" t "View Glow Effect." +STARTLINE}
  glow_only {{"parent.preview ==5"}}
  addUserKnob {6 clamp_alpha l "Clamp Alpha" t "It clamps the alpha channel overall." -STARTLINE}
  clamp_alpha true
  addUserKnob {41 in l channels t "Channels where the glow is affected. By default is 'rgb' channel. The alpha is always getting by the beauty/rgba layer." T Shuffle1.in}
  addUserKnob {26 main_text l "@b;Main" t "Main section."}
  addUserKnob {3 sample t "Resolution in the effect. More samples = smooth transition. Max samples: 11."}
  sample 5
  addUserKnob {7 anamorph t "Simulates anamorphic lens flares by altering the default 1:1 flare shape."}
  anamorph 1
  addUserKnob {7 intensity t "Intensity of the effect (Glow)." R 0 10}
  intensity 0.25
  addUserKnob {6 tint_panelDropped l "panel dropped state" +HIDDEN +STARTLINE}
  tint_panelDropped true
  addUserKnob {6 color_rgb_panelDropped l "panel dropped state" -STARTLINE +HIDDEN}
  color_rgb_panelDropped true
  addUserKnob {41 value l tint t "Tint color of the effect (Glow)." T Multiply1.value}
  addUserKnob {7 size t "Size of the effect (Glow)." R 0.0001 100}
  size 10
  addUserKnob {7 b l "falloff mix" t "It makes the transition smooth. (1) Sharp, more than 1 value is smoother. Falloff min and max knobs are using an exponential expression and falloff min is the minimum expression and max is the maximum expression." R 1 10}
  b 1
  addUserKnob {7 a l "falloff max" t "It makes the transition smooth. (1) Sharp, more than 1 value is smoother. Falloff min and max knobs are using an exponential expression and falloff min is the minimum expression and max is the maximum expression." R 1 10}
  a 2
  addUserKnob {7 highlights t "Checkbox 'enable highlights' to make that work. It clamps the highlight values (maximum) before the (Glow) effect. " R 0 10}
  highlights 1
  addUserKnob {6 enable_highlights l "enable highlights" t "Checbox this box if you want to play with highlights (maxiumum values)." -STARTLINE}
  addUserKnob {7 tolerance t "It makes a \"Contrast\" in black values in the effect (Glow)." R 0 10}
  addUserKnob {7 overscan t "How many percent of the crop is overscanning." R 0 100}
  overscan 10
  addUserKnob {6 crop l "enable crop" t "Crops overscan to root format. " -STARTLINE}
  crop true
  addUserKnob {41 black_clamp l "black clamp" t "Black clamp overall (includes the alpha channel)." T Grade.black_clamp}
  addUserKnob {41 white_clamp l "white clamp" t "White clamp overall (includes the alpha channel)." -STARTLINE T Grade.white_clamp}
  addUserKnob {26 ""}
  addUserKnob {26 _1 l mask T ""}
  addUserKnob {41 maskChannelInput l "" -STARTLINE T Merge3.maskChannelInput}
  addUserKnob {41 inject -STARTLINE T Merge3.inject}
  addUserKnob {41 invert_mask l invert -STARTLINE T Merge3.invert_mask}
  addUserKnob {41 fringe -STARTLINE T Merge3.fringe}
  addUserKnob {41 mix t "Mix of the Mask Input." T Merge3.mix}
  addUserKnob {26 ""}
  addUserKnob {26 Autor l "" +STARTLINE T "<font color=\"grey\">emGlow v1.8 | emateofabregas.com | 2024 </font>"}
 }
  Input {
   inputs 0
   name InputMask
   xpos 106
   ypos 37
   number 1
  }
  Input {
   inputs 0
   name InputImg
   xpos -84
   ypos 36
  }
  Dot {
   name Dot1
   xpos -50
   ypos 83
  }
set N88b64800 [stack 0]
  Shuffle {
   in rgb
   in2 rgba
   alpha alpha2
   name Shuffle1
   xpos -8
   ypos 80
  }
  Merge2 {
   inputs 2
   operation mask
   name Merge3
   xpos 106
   ypos 80
   disable {{"!\[exists parent.input1]"}}
  }
set N88b70f00 [stack 0]
push $N88b70f00
  Grade {
   inputs 1+1
   channels rgba
   white {{0.0001+parent.intensity*0.1}}
   add {{-parent.tolerance*0.001}}
   maskChannelMask none
   name Grade
   xpos 106
   ypos 110
  }
  Clamp {
   channels rgb
   minimum_enable false
   maximum {{parent.highlights}}
   maximum_enable {{parent.enable_highlights}}
   name Clamp1
   xpos 106
   ypos 134
  }
set N88bb2000 [stack 0]
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*1024} {parent.BlurMaster.size*pow(a,b)*1024}}
   crop false
   name Blur10
   label "\[value size.w]"
   xpos 1172
   ypos 174
   disable {{"sample < 11"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*512} {parent.BlurMaster.size*pow(a,b)*512}}
   crop false
   name Blur9
   label "\[value size.w]"
   xpos 1070
   ypos 176
   disable {{"sample < 10"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*256} {parent.BlurMaster.size*pow(a,b)*256}}
   crop false
   name Blur8
   label "\[value size.w]"
   xpos 973
   ypos 176
   disable {{"sample < 9"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*128} {parent.BlurMaster.size*pow(a,b)*128}}
   crop false
   name Blur7
   label "\[value size.w]"
   xpos 880
   ypos 175
   disable {{"sample < 8"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*64} {parent.BlurMaster.size*pow(a,b)*64}}
   crop false
   name Blur6
   label "\[value size.w]"
   xpos 786
   ypos 175
   disable {{"sample < 7"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*32} {parent.BlurMaster.size*pow(a,b)*32}}
   crop false
   name Blur1
   label "\[value size.w]"
   xpos 682
   ypos 176
   disable {{"sample < 6"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*16} {parent.BlurMaster.size*pow(a,b)*16}}
   crop false
   name Blur5
   label "\[value size.w]"
   xpos 578
   ypos 176
   disable {{"sample < 5"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*8} {parent.BlurMaster.size*pow(a,b)*8}}
   crop false
   name Blur4
   label "\[value size.w]"
   xpos 484
   ypos 176
   disable {{"sample < 4"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*4} {parent.BlurMaster.size*pow(a,b)*4}}
   crop false
   name Blur3
   label "\[value size.w]"
   xpos 391
   ypos 175
   disable {{"sample < 3"}}
  }
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.BlurMaster.size*pow(a,b)*2} {parent.BlurMaster.size*pow(a,b)*2}}
   crop false
   name Blur2
   label "\[value size.w]"
   xpos 287
   ypos 176
   disable {{"sample < 2"}}
  }
push 0
push $N88bb2000
  Blur {
   channels rgba
   size {{parent.size} {parent.BlurMaster.size.w*anamorph}}
   crop false
   name BlurMaster
   xpos 164
   ypos 186
   disable {{"sample == 0"}}
  }
push $N88bb2000
  Merge2 {
   inputs 12+1
   operation plus
   name MergeBlur
   xpos 106
   ypos 232
  }
  Multiply {
   channels rgba
   value {0.895306 0.938587 1.016107 1}
   name Multiply1
   xpos 106
   ypos 260
  }
  Clamp {
   channels alpha
   minimum_enable false
   maximum_enable {{clamp_alpha}}
   name ClampAlpha
   xpos 106
   ypos 290
  }
push $N88b64800
  Remove {
   channels rgba
   name Remove1
   xpos -84
   ypos 174
   disable {{!parent.glow_only}}
  }
  Merge2 {
   inputs 2
   operation plus
   name MergeGlow
   xpos -84
   ypos 296
   disable {{"parent.intensity == 0"}}
  }
  Crop {
   box {{parent.crop?0:-parent.overscan} {parent.crop?0:-parent.overscan} {parent.crop?width:width+parent.overscan} {parent.crop?height:height+parent.overscan}}
   name CropOverscan
   xpos -84
   ypos 334
  }
  Output {
   name Output1
   xpos -84
   ypos 374
  }
 end_group
set Nab0ac700 [stack 0]
push $N883d0d00
push $N88364800
 Grade {
  channels rgba
  white {{parent.opacity_1}}
  name Grade6
  label Opacity
  xpos -537
  ypos 583
 }
 Premult {
  name Premult2
  xpos -537
  ypos 691
 }
push $N88b4e800
push $N883f9200
push $N88ae6800
 Switch {
  inputs 2
  which {{parent.mode}}
  name Switch_PreFog
  label "\[value which]"
  xpos -481
  ypos 999
  hide_input true
 }
 Shuffle {
  in alpha
  in2 rgba
  alpha red
  name view_alpha
  xpos -356
  ypos 1005
 }
 Grade {
  channels rgba
  white {{parent.Grade2.white}}
  name Grade4
  label "Opacity Preview"
  xpos -222
  ypos 999
 }
push $Nab0ac700
 Switch {
  inputs 6
  which {{parent.preview}}
  name Switch1
  label "view mode: \[value which]"
  xpos 0
  ypos 999
 }
add_layer {ID_depthFog ID_depthFog.red ID_depthFog.green ID_depthFog.blue ID_depthFog.alpha}
 ShuffleCopy {
  inputs 2
  alpha alpha2
  black red
  white green
  red2 blue
  green2 alpha
  out2 ID_depthFog
  name ShuffleCopy1
  label "\[value out2]"
  xpos 0
  ypos 1076
  disable {{!parent.generate_id_depthFog}}
 }
add_layer {ID_skyRamp ID_skyRamp.red ID_skyRamp.green ID_skyRamp.blue ID_skyRamp.alpha}
 ShuffleCopy {
  inputs 2
  alpha alpha2
  black red
  white green
  red2 blue
  green2 alpha
  out2 ID_skyRamp
  name ShuffleCopy2
  label "\[value out2]"
  xpos 0
  ypos 1135
  disable {{!parent.generate_id_skyRamp}}
 }
add_layer {ID_fogFX ID_fogFX.red ID_fogFX.green ID_fogFX.blue ID_fogFX.alpha}
 ShuffleCopy {
  inputs 2
  alpha alpha2
  black red
  white green
  red2 blue
  green2 alpha
  out2 ID_fogFX
  name ShuffleCopy3
  label "\[value out2]"
  xpos 0
  ypos 1198
  disable {{!parent.generate_id_fogFX}}
 }
 Crop {
  box {{parent.crop?0:-parent.overscan} {parent.crop?0:-parent.overscan} {parent.crop?width:width+parent.overscan} {parent.crop?height:height+parent.overscan}}
  name CropOverscan
  xpos 0
  ypos 1253
 }
 Output {
  name Output1
  xpos 0
  ypos 1292
 }
end_group
